<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Universal GraphQL Search Showcase</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; padding: 20px; max-width: 900px; margin: 0 auto; background-color: #f4f7f6; }
        h1 { color: #2c3e50; text-align: center; margin-bottom: 30px; }
        .card { background: white; border: none; padding: 25px; margin-bottom: 25px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        h3 { margin-top: 0; color: #34495e; border-bottom: 2px solid #3498db; padding-bottom: 10px; display: inline-block; }
        p { color: #7f8c8d; margin-top: 10px; }
        pre { background: #2d3436; color: #f1f2f6; padding: 15px; border-radius: 8px; overflow-x: auto; font-size: 14px; line-height: 1.5; }
        button { padding: 12px 24px; cursor: pointer; background-color: #3498db; color: white; border: none; border-radius: 6px; font-size: 16px; font-weight: 600; transition: all 0.3s; display: block; width: 100%; margin-top: 15px; }
        button:hover { background-color: #2980b9; transform: translateY(-1px); }
        .response-label { margin-top: 20px; font-weight: bold; color: #2c3e50; font-size: 14px; text-transform: uppercase; letter-spacing: 1px; }
        .result-box { min-height: 60px; color: #27ae60; background: #fdfdfd; border: 1px solid #eee; margin-top: 10px; }
        .error-box { color: #e74c3c !important; border-color: #fab1a0; }
        hr { border: 0; height: 1px; background: #dfe6e9; margin: 40px 0; }
        .badge { background: #3498db; color: white; padding: 2px 8px; border-radius: 4px; font-size: 12px; vertical-align: middle; margin-left: 10px; }
    </style>
</head>
<body>
    <h1>Universal Product Search <span class="badge">POC</span></h1>

    <!-- 1. Global Search -->
    <div class="card">
        <h3>1. Global Full-Text Search</h3>
        <p>Google-like search across <b>Name, SKU, Category,</b> and <b>all Custom Attributes</b>. Try searching for "Navy" or "Cotton" or "Mechanical".</p>
        <pre id="q1">
query {
  searchProducts(text: "Navy") {
    results {
      name
      category
      custom_attributes
    }
  }
}</pre>
        <button onclick="runQuery('q1', 'r1')">Run Global Search</button>
        <div class="response-label">Response:</div>
        <pre id="r1" class="result-box">Waiting for action...</pre>
    </div>

    <!-- 2. Filtering Core Fields -->
    <div class="card">
        <h3>2. Filter by Core Field (Numeric)</h3>
        <p>Find products where <b>price</b> is greater than 50.</p>
        <pre id="q2">
query {
  searchProducts(filter: [
    { field: "price", gt: 50.0 }
  ]) {
    results {
      name
      price
    }
  }
}</pre>
        <button onclick="runQuery('q2', 'r2')">Run Price Filter</button>
        <div class="response-label">Response:</div>
        <pre id="r2" class="result-box">Waiting for action...</pre>
    </div>

    <!-- 3. Filtering Custom Attributes -->
    <div class="card">
        <h3>3. Filter by Custom Attribute</h3>
        <p>Find products where the <b>dynamic</b> attribute "color" is exactly "black".</p>
        <pre id="q3">
query {
  searchProducts(filter: [
    { field: "color", eq: "black" }
  ]) {
    results {
      name
      custom_attributes
    }
  }
}</pre>
        <button onclick="runQuery('q3', 'r3')">Run Attribute Filter</button>
        <div class="response-label">Response:</div>
        <pre id="r3" class="result-box">Waiting for action...</pre>
    </div>

    <!-- 4. Nested Search -->
    <div class="card">
        <h3>4. Nested Search (Reviews)</h3>
        <p>Find products where any review <b>rating</b> is 5 stars.</p>
        <pre id="q4">
query {
  searchProducts(filter: [
    { field: "rating", eq: "5" }
  ]) {
    results {
      name
      reviews { author, rating }
    }
  }
}</pre>
        <button onclick="runQuery('q4', 'r4')">Run Rating Filter</button>
        <div class="response-label">Response:</div>
        <pre id="r4" class="result-box">Waiting for action...</pre>
    </div>

    <!-- 5. Dynamic Faceting -->
    <div class="card">
        <h3>5. Dynamic Faceting</h3>
        <p>Get aggregate counts for <b>Category</b> and custom <b>Color</b> on the fly. Returns a clean JSON map!</p>
        <pre id="q5">
query {
  searchProducts(facetKeys: ["category", "color"]) {
    facets
  }
}</pre>
        <button onclick="runQuery('q5', 'r5')">Run Facet Aggregations</button>
        <div class="response-label">Response:</div>
        <pre id="r5" class="result-box">Waiting for action...</pre>
    </div>

    <!-- 6. Dynamic Stats -->
    <div class="card">
        <h3>6. Dynamic Numeric Stats</h3>
        <p>Get min/max/avg for <b>Price</b> and <b>Rating</b> across matching products.</p>
        <pre id="q6">
query {
  searchProducts(statsKeys: ["price", "rating"]) {
    stats
  }
}</pre>
        <button onclick="runQuery('q6', 'r6')">Run Statistical Summary</button>
        <div class="response-label">Response:</div>
        <pre id="r6" class="result-box">Waiting for action...</pre>
    </div>

    <!-- 7. Dynamic Sorting -->
    <div class="card">
        <h3>7. Dynamic Sorting</h3>
        <p>Sort by <b>Price</b> (Highest First) using the unified string syntax.</p>
        <pre id="q7">
query {
  searchProducts(sort: [{ field: "price", direction: DESC }]) {
    results {
      name
      price
    }
  }
}</pre>
        <button onclick="runQuery('q7', 'r7')">Run Sorted Search</button>
        <div class="response-label">Response:</div>
        <pre id="r7" class="result-box">Waiting for action...</pre>
    </div>

    <!-- 8. Advanced Boolean Logic -->
    <div class="card">
        <h3>8. Advanced Boolean Logic (OR/AND)</h3>
        <p>Find products where <b>(Category is Electronics OR Color is Navy)</b> AND <b>Price < 100</b>.</p>
        <pre id="q8">
query {
  searchProducts(filter: [
    {
      or: [
        { field: "category", eq: "Electronics" },
        { field: "color", eq: "navy blue" }
      ]
    },
    { field: "price", lt: 100.0 }
  ]) {
    results {
      name
      category
      custom_attributes
    }
  }
}</pre>
        <button onclick="runQuery('q8', 'r8')">Run Boolean Query</button>
        <div class="response-label">Response:</div>
        <pre id="r8" class="result-box">Waiting for action...</pre>
    </div>

    <!-- 9. THE KITCHEN SINK -->
    <div class="card" style="background: #edf2f7; border: 2px dashed #3498db;">
        <h3>9. THE "KITCHEN SINK"</h3>
        <p>Combining everything: Full-Text + Recursive Logic + Facets + Stats + Pagination + SKU Alias + <b>Brand Lookups</b>.</p>
        <pre id="q9">
query {
  searchProducts(
    text: "Cotton",
    filter: [ 
      { 
        or: [
          { field: "price", gt: 10.0 },
          { field: "color", eq: "black" }
        ]
      } 
    ],
    facetKeys: ["category", "color"],
    statsKeys: ["price", "rating"],
    sort: [{ field: "name", direction: ASC }],
    page: 0,
    size: 10
  ) {
    totalElements
    results {
      name
      sku
      price
      category
      brand {
        name
      }
      custom_attributes
    }
    facets
    stats
  }
}</pre>
        <button onclick="runQuery('q9', 'r9')" style="background-color: #2c3e50;">Run Master Query</button>
        <div class="response-label">Response:</div>
        <pre id="r9" class="result-box">Waiting for action...</pre>
    </div>

    <!-- 10. Nested Lookup Search -->
    <div class="card">
        <h3>10. Nested Lookup Search (Brands)</h3>
        <p>Find products by searching for text within the <b>Brand</b> name. This demonstrates retrieving rich, immutable configuration data from the Caffeine cache.</p>
        <pre id="q10">
query {
  searchProducts(text: "Logitech") {
    results {
      name
      brand {
        name
        description
        lookupType
      }
    }
  }
}</pre>
        <button onclick="runQuery('q10', 'r10')">Run Brand Search</button>
        <div class="response-label">Response:</div>
        <pre id="r10" class="result-box">Waiting for action...</pre>
    </div>

    <!-- 11. Flat Tabular Join -->
    <div class="card" style="border: 2px solid #27ae60;">
        <h3>11. Flat Tabular Join (Product + Review + Brand)</h3>
        <p>This query returns a <b>flat list of rows</b> (one row per review). It aggregates data from the Product entity, the Review collection, and the Brand cache into a single tabular structure.</p>
        <pre id="q11">
query {
  searchProductReviewTable(text: "Amazing") {
    productName
    sku
    brandName
    author
    comment
    rating
  }
}</pre>
        <button onclick="runQuery('q11', 'r11')" style="background-color: #27ae60;">Run Tabular Search</button>
        <div class="response-label">Response:</div>
        <pre id="r11" class="result-box">Waiting for action...</pre>
    </div>

    <script>
        async function runQuery(queryElementId, resultElementId) {
            const queryElement = document.getElementById(queryElementId);
            const resultElement = document.getElementById(resultElementId);
            const query = queryElement.innerText;
            
            resultElement.innerText = "Processing universal search...";
            resultElement.classList.remove('error-box');

            try {
                const response = await fetch('/graphql', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json',
                    },
                    body: JSON.stringify({ query: query })
                });

                const data = await response.json();
                resultElement.innerText = JSON.stringify(data, null, 2);
                
                if (data.errors) {
                    resultElement.classList.add('error-box');
                }
            } catch (error) {
                resultElement.innerText = "Search Error: " + error.message;
                resultElement.classList.add('error-box');
            }
        }
    </script>
</body>
</html>