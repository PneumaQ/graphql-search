<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GraphQL Person Client</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; padding: 20px; max-width: 800px; margin: 0 auto; background-color: #f9f9f9; }
        h1 { color: #333; text-align: center; }
        .card { background: white; border: 1px solid #ddd; padding: 20px; margin-bottom: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        h3 { margin-top: 0; color: #555; }
        pre { background: #f4f4f4; padding: 15px; border-radius: 5px; overflow-x: auto; font-size: 14px; border: 1px solid #eee; }
        button { padding: 12px 20px; cursor: pointer; background-color: #007bff; color: white; border: none; border-radius: 5px; font-size: 16px; transition: background-color 0.2s; display: block; width: 100%; }
        button:hover { background-color: #0056b3; }
        .response-label { margin-top: 15px; font-weight: bold; color: #333; }
        .result-box { min-height: 40px; color: #006600; }
        .error-box { color: #cc0000; }
    </style>
</head>
<body>
    <h1>GraphQL Person Manager</h1>

    <h2>Mutations</h2>

    <div class="card">
        <h3>1. Create Person (Mutation)</h3>
        <p>Creates a new person named "Alice" with extra details.</p>
        <pre id="query-create">
mutation {
  createPerson(
    name: "Alice", 
    age: 30, 
    email: "alice@example.com", 
    isActive: true, 
    salary: 95000.0
  ) {
    id
    name
    email
    isActive
  }
}</pre>
        <button onclick="runQuery('query-create', 'result-create')">Run Create Mutation</button>
        <div class="response-label">Response:</div>
        <pre id="result-create" class="result-box">Waiting for action...</pre>
    </div>

    <div class="card">
        <h3>2. Add Address to Person (Mutation)</h3>
        <p>Adds an address to Person ID 1.</p>
        <pre id="query-address">
mutation {
  addAddress(
    personId: "1", 
    street: "123 Main St", 
    city: "New York", 
    state: "NY", 
    zip: "10001",
    country: "USA",
    isPrimary: true
  ) {
    id
    name
    addresses {
      street
      city
      isPrimary
    }
  }
}</pre>
        <button onclick="runQuery('query-address', 'result-address')">Run Add Address</button>
        <div class="response-label">Response:</div>
        <pre id="result-address" class="result-box">Waiting for action...</pre>
    </div>

    <hr>
    <h2>Elasticsearch Queries</h2>

    <div class="card">
        <h3>3. Global Search (Google-like)</h3>
        <p>Full-text search across Name, Email, Phone, Street, City, Zip, and Country.</p>
        <pre id="query-search">
query {
  searchPeople(text: "New York") {
    results {
      id
      name
      email
      addresses {
        street
        city
      }
    }
  }
}</pre>
        <button onclick="runQuery('query-search', 'result-search')">Run Global Search</button>
        <div class="response-label">Response:</div>
        <pre id="result-search" class="result-box">Waiting for action...</pre>
    </div>

    <div class="card">
        <h3>4. Get Name Facets (Aggregation)</h3>
        <p>Counts the occurrences of each name in the index.</p>
        <pre id="query-facets">
query {
  searchPeople(text: "") {
    facets {
       # We only have active/country/state implemented in the unified controller.
       # We removed 'nameFacets' from schema.
       # Using active count as example replacement.
       byActive { value, count }
    }
  }
}</pre>
        <button onclick="runQuery('query-facets', 'result-facets')">Run Facet Query</button>
        <div class="response-label">Response:</div>
        <pre id="result-facets" class="result-box">Waiting for action...</pre>
    </div>

    <div class="card">
        <h3>5. Search with Facets</h3>
        <p>Global search plus aggregated counts for Active status, Country, and State.</p>
        <pre id="query-faceted">
query {
  searchPeople(text: "") {
    results {
      name
      email
    }
    facets {
      byActive { value, count }
      byCountry { value, count }
      byState { value, count }
    }
  }
}</pre>
        <button onclick="runQuery('query-faceted', 'result-faceted')">Run Faceted Search</button>
        <div class="response-label">Response:</div>
        <pre id="result-faceted" class="result-box">Waiting for action...</pre>
    </div>

    <div class="card">
        <h3>6. Rich Filter (Date & Prefix)</h3>
        <p>Global search for "John" AND (BirthDate < 2000-01-01) AND Name starts with "J".</p>
        <pre id="query-filtered">
query {
  searchPeople(
    text: "John", 
    filter: { 
      birthDate: { lt: "2000-01-01" }
      name: { startsWith: "J" }
    },
    page: 0,
    size: 5
  ) {
    totalElements
    results {
      name
      birthDate
    }
  }
}</pre>
        <button onclick="runQuery('query-filtered', 'result-filtered')">Run Rich Filter Search</button>
        <div class="response-label">Response:</div>
        <pre id="result-filtered" class="result-box">Waiting for action...</pre>
    </div>

    <div class="card">
        <h3>7. Sorted Search</h3>
        <p>Global search + Sorting by Salary (Highest First).</p>
        <pre id="query-sorted">
query {
  searchPeople(
    text: "", 
    sort: [{ field: SALARY, direction: DESC }]
  ) {
    results {
      name
      salary
    }
  }
}</pre>
        <button onclick="runQuery('query-sorted', 'result-sorted')">Run Sorted Search</button>
        <div class="response-label">Response:</div>
        <pre id="result-sorted" class="result-box">Waiting for action...</pre>
    </div>

    <div class="card">
        <h3>8. Search with Facets & Stats</h3>
        <p>Global search plus aggregated counts and numerical stats for Age and Salary.</p>
        <pre id="query-stats">
query {
  searchPeople(text: "") {
    results {
      name
      age
      salary
    }
    facets {
      byActive { value, count }
    }
    stats {
      age { min, max, avg, sum, count }
      salary { min, max, avg, sum, count }
    }
  }
}</pre>
        <button onclick="runQuery('query-stats', 'result-stats')">Run Stats Search</button>
        <div class="response-label">Response:</div>
        <pre id="result-stats" class="result-box">Waiting for action...</pre>
    </div>

    <div class="card">
        <h3>9. Multi-Field Sort</h3>
        <p>Sort by Active Status (Descending) THEN by Salary (Ascending).</p>
        <pre id="query-multisort">
query {
  searchPeople(
    text: "", 
    sort: [
      { field: AGE, direction: DESC },
      { field: SALARY, direction: ASC }
    ]
  ) {
    results {
      name
      age
      salary
    }
  }
}</pre>
        <button onclick="runQuery('query-multisort', 'result-multisort')">Run Multi-Sort Search</button>
        <div class="response-label">Response:</div>
        <pre id="result-multisort" class="result-box">Waiting for action...</pre>
    </div>

    <div class="card">
        <h3>10. Complex Boolean Logic</h3>
        <p>Filter: (Name contains "John" OR Name contains "Jane") AND (Age > 25)</p>
        <pre id="query-boolean">
query {
  searchPeople(
    text: "", 
    filter: {
      and: [
        {
            or: [
                { name: { contains: "John" } },
                { name: { contains: "Jane" } }
            ]
        },
        { age: { gt: 25 } }
      ]
    }
  ) {
    totalElements
    results {
      name
      age
    }
  }
}</pre>
        <button onclick="runQuery('query-boolean', 'result-boolean')">Run Boolean Logic Search</button>
        <div class="response-label">Response:</div>
        <pre id="result-boolean" class="result-box">Waiting for action...</pre>
    </div>

    <div class="card">
        <h3>11. Search Publications</h3>
        <p>Search by Title or Author Name (e.g., "Medical" or "Smith").</p>
        <pre id="query-pub-search">
query {
  searchPublications(text: "Smith") {
    title
    journalName
    authors {
      rank
      person {
        name
      }
      affiliationAtTimeOfPublication
    }
  }
}</pre>
        <button onclick="runQuery('query-pub-search', 'result-pub-search')">Run Publication Search</button>
        <div class="response-label">Response:</div>
        <pre id="result-pub-search" class="result-box">Waiting for action...</pre>
    </div>

    <div class="card">
        <h3>12. The "Kitchen Sink" Query</h3>
        <p>Full-Text + Structured Filter (Nested Boolean) + Facets + Stats + Pagination + Multi-Field Sorting.</p>
        <pre id="query-kitchensink">
query {
  searchPeople(
    text: "John",
    filter: {
      and: [
        { age: { gt: 20 } },
        { addresses_country: { eq: "USA" } }
      ]
    },
    page: 0,
    size: 10,
    sort: [
      { field: SALARY, direction: DESC },
      { field: NAME, direction: ASC }
    ]
  ) {
    totalElements
    totalPages
    results {
      name
      age
      salary
      email
      addresses {
        city
        country
      }
    }
    stats {
      salary { min, max, avg, sum }
      age { min, max, avg }
    }
    facets {
      byActive { value, count }
      byCountry { value, count }
    }
  }
}</pre>
        <button onclick="runQuery('query-kitchensink', 'result-kitchensink')">Run All Features Search</button>
        <div class="response-label">Response:</div>
        <pre id="result-kitchensink" class="result-box">Waiting for action...</pre>
    </div>

    <script>
        async function runQuery(queryElementId, resultElementId) {
            const queryElement = document.getElementById(queryElementId);
            const resultElement = document.getElementById(resultElementId);
            const query = queryElement.innerText;
            
            resultElement.innerText = "Loading...";
            resultElement.classList.remove('error-box');

            try {
                const response = await fetch('/graphql', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json',
                    },
                    body: JSON.stringify({ query: query })
                });

                const data = await response.json();
                resultElement.innerText = JSON.stringify(data, null, 2);
                
                if (data.errors) {
                    resultElement.classList.add('error-box');
                }
            } catch (error) {
                resultElement.innerText = "Network Error: " + error.message;
                resultElement.classList.add('error-box');
            }
        }
    </script>
</body>
</html>