<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GraphQL Person Client</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; padding: 20px; max-width: 800px; margin: 0 auto; background-color: #f9f9f9; }
        h1 { color: #333; text-align: center; }
        .card { background: white; border: 1px solid #ddd; padding: 20px; margin-bottom: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        h3 { margin-top: 0; color: #555; }
        pre { background: #f4f4f4; padding: 15px; border-radius: 5px; overflow-x: auto; font-size: 14px; border: 1px solid #eee; }
        button { padding: 12px 20px; cursor: pointer; background-color: #007bff; color: white; border: none; border-radius: 5px; font-size: 16px; transition: background-color 0.2s; display: block; width: 100%; }
        button:hover { background-color: #0056b3; }
        .response-label { margin-top: 15px; font-weight: bold; color: #333; }
        .result-box { min-height: 40px; color: #006600; }
        .error-box { color: #cc0000; }
    </style>
</head>
<body>
    <h1>GraphQL Person Manager</h1>

    <h2>Mutations</h2>

    <div class="card">
        <h3>1. Create Person (Mutation)</h3>
        <p>Creates a new person named "Alice" with extra details.</p>
        <pre id="query-create">
mutation {
  createPerson(
    name: "Alice", 
    age: 30, 
    email: "alice@example.com", 
    isActive: true, 
    salary: 95000.0
  ) {
    id
    name
    email
    isActive
  }
}</pre>
        <button onclick="runQuery('query-create', 'result-create')">Run Create Mutation</button>
        <div class="response-label">Response:</div>
        <pre id="result-create" class="result-box">Waiting for action...</pre>
    </div>

    <div class="card">
        <h3>2. Add Address to Person (Mutation)</h3>
        <p>Adds an address to Person ID 1.</p>
        <pre id="query-address">
mutation {
  addAddress(
    personId: "1", 
    street: "123 Main St", 
    city: "New York", 
    state: "NY", 
    zip: "10001",
    country: "USA",
    isPrimary: true
  ) {
    id
    name
    addresses {
      street
      city
      isPrimary
    }
  }
}</pre>
        <button onclick="runQuery('query-address', 'result-address')">Run Add Address</button>
        <div class="response-label">Response:</div>
        <pre id="result-address" class="result-box">Waiting for action...</pre>
    </div>

    <hr>
    <h2>Database Queries (JPA)</h2>

    <div class="card">
        <h3>3. Get All Persons (with Addresses)</h3>
        <p>Fetches the list of all people and their addresses.</p>
        <pre id="query-all">
query {
  persons {
    id
    name
    email
    salary
    isActive
    addresses {
      street
      city
      country
    }
  }
}</pre>
        <button onclick="runQuery('query-all', 'result-all')">Run List Query</button>
        <div class="response-label">Response:</div>
        <pre id="result-all" class="result-box">Waiting for action...</pre>
    </div>

    <div class="card">
        <h3>4. Get Person by ID</h3>
        <p>Fetches a specific person with ID 1.</p>
        <pre id="query-one">
query {
  personById(id: "1") {
    id
    name
    age
    email
    birthDate
  }
}</pre>
        <button onclick="runQuery('query-one', 'result-one')">Run ID Query</button>
        <div class="response-label">Response:</div>
        <pre id="result-one" class="result-box">Waiting for action...</pre>
    </div>

    <div class="card">
        <h3>5. Get Person with Full Address</h3>
        <p>Fetches Person ID 1 with all address fields.</p>
        <pre id="query-full-address">
query {
  personById(id: "1") {
    name
    addresses {
      street
      city
      state
      zip
      country
      isPrimary
    }
  }
}</pre>
        <button onclick="runQuery('query-full-address', 'result-full-address')">Run Full Address Query</button>
        <div class="response-label">Response:</div>
        <pre id="result-full-address" class="result-box">Waiting for action...</pre>
    </div>

    <div class="card">
        <h3>6. Find Persons by City</h3>
        <p>Finds all people living in "New York".</p>
        <pre id="query-city">
query {
  personsByCity(city: "New York") {
    name
    addresses {
      street
      city
      zip
    }
  }
}</pre>
        <button onclick="runQuery('query-city', 'result-city')">Run City Search</button>
        <div class="response-label">Response:</div>
        <pre id="result-city" class="result-box">Waiting for action...</pre>
    </div>

    <hr>
    <h2>Elasticsearch Queries</h2>

    <div class="card">
        <h3>7. Global Search (Google-like)</h3>
        <p>Full-text search across Name, Email, Phone, Street, City, Zip, and Country.</p>
        <pre id="query-search">
query {
  searchPeople(text: "New York") {
    id
    name
    email
    addresses {
      street
      city
    }
  }
}</pre>
        <button onclick="runQuery('query-search', 'result-search')">Run Global Search</button>
        <div class="response-label">Response:</div>
        <pre id="result-search" class="result-box">Waiting for action...</pre>
    </div>

    <div class="card">
        <h3>8. Get Name Facets (Aggregation)</h3>
        <p>Counts the occurrences of each name in the index.</p>
        <pre id="query-facets">
query {
  nameFacets {
    value
    count
  }
}</pre>
        <button onclick="runQuery('query-facets', 'result-facets')">Run Facet Query</button>
        <div class="response-label">Response:</div>
        <pre id="result-facets" class="result-box">Waiting for action...</pre>
    </div>

    <div class="card">
        <h3>9. Search with Facets</h3>
        <p>Global search plus aggregated counts for Active status, Country, and State.</p>
        <pre id="query-faceted">
query {
  searchWithFacets(text: "") {
    items {
      name
      email
    }
    facets {
      byActive { value, count }
      byCountry { value, count }
      byState { value, count }
    }
  }
}</pre>
        <button onclick="runQuery('query-faceted', 'result-faceted')">Run Faceted Search</button>
        <div class="response-label">Response:</div>
        <pre id="result-faceted" class="result-box">Waiting for action...</pre>
    </div>

    <div class="card">
        <h3>10. Rich Filter (Complex Logic)</h3>
        <p>Global search for "John" AND (Salary > 80,000 OR Active=True) AND Country="USA".</p>
        <pre id="query-filtered">
query {
  searchWithFacets(
    text: "", 
    filter: { 
      address_country: { eq: "USA" }
      or: [
        { salary: { gt: 80000.0 } },
        { isActive: { eq: true } }
      ]
    },
    page: 0,
    size: 5
  ) {
    totalElements
    items {
      name
      email
      salary
      isActive
    }
  }
}</pre>
        <button onclick="runQuery('query-filtered', 'result-filtered')">Run Rich Filter Search</button>
        <div class="response-label">Response:</div>
        <pre id="result-filtered" class="result-box">Waiting for action...</pre>
    </div>

    <div class="card">
        <h3>11. Sorted Search</h3>
        <p>Global search + Sorting by Salary (Highest First).</p>
        <pre id="query-sorted">
query {
  searchWithFacets(
    text: "", 
    sort: { field: SALARY, direction: DESC }
  ) {
    items {
      name
      salary
    }
  }
}</pre>
        <button onclick="runQuery('query-sorted', 'result-sorted')">Run Sorted Search</button>
        <div class="response-label">Response:</div>
        <pre id="result-sorted" class="result-box">Waiting for action...</pre>
    </div>

    <script>
        async function runQuery(queryElementId, resultElementId) {
            const queryElement = document.getElementById(queryElementId);
            const resultElement = document.getElementById(resultElementId);
            const query = queryElement.innerText;
            
            resultElement.innerText = "Loading...";
            resultElement.classList.remove('error-box');

            try {
                const response = await fetch('/graphql', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json',
                    },
                    body: JSON.stringify({ query: query })
                });

                const data = await response.json();
                resultElement.innerText = JSON.stringify(data, null, 2);
                
                if (data.errors) {
                    resultElement.classList.add('error-box');
                }
            } catch (error) {
                resultElement.innerText = "Network Error: " + error.message;
                resultElement.classList.add('error-box');
            }
        }
    </script>
</body>
</html>